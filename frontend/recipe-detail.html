<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recipe Details | Asian Food Explorer</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/all.min.css">
</head>

<body>
    <nav class="glass">
        <div class="logo">Asian<span>Food</span></div>
        <div class="nav-toggle" id="navToggle">
            <i class="fas fa-bars"></i>
        </div>
        <div class="nav-menu">
            <ul class="nav-links">
                <li><a href="index.html">Home</a></li>
                <li><a href="index.html#recipes">Recipes</a></li>
                <li id="auth-link"><a href="login.html" class="btn btn-primary">Login</a></li>
            </ul>
        </div>
    </nav>

    <div class="recipe-detail-container">
        <div id="recipeDetail" class="glass" style="max-width: 900px; margin: 40px auto; padding: 40px;">
            <div class="loading">
                <i class="fas fa-spinner fa-spin"></i> Loading delicious recipe...
            </div>
        </div>
    </div>

    <div id="notification"></div>

    <script src="js/auth.js"></script>
    <script src="js/main.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            const urlParams = new URLSearchParams(window.location.search);
            const recipeId = urlParams.get('id');

            if (!recipeId) {
                window.location.href = 'index.html';
                return;
            }

            const container = document.getElementById('recipeDetail');

            try {
                const response = await fetch(`http://127.0.0.1:5000/api/recipes/${recipeId}`);
                if (!response.ok) throw new Error('Recipe not found');

                const recipe = await response.json();

                container.innerHTML = `
                    <div style="display: flex; gap: 40px; flex-wrap: wrap;">
                        <div style="flex: 1; min-width: 300px;">
                            <img src="${recipe.image || 'https://images.unsplash.com/photo-1512621776951-a57141f2eefd?auto=format&fit=crop&q=80&w=1000'}" 
                                 alt="${recipe.title}" style="width: 100%; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.3);">
                        </div>
                        <div style="flex: 1.5; min-width: 300px;">
                            <div class="badge" style="display: inline-block; margin-bottom: 15px;">${recipe.cuisineType}</div>
                            <h1 style="font-size: 2.5rem; margin-bottom: 20px; color: var(--secondary);">${recipe.title}</h1>
                            <p style="font-size: 1.1rem; color: #ccc; margin-bottom: 25px;">${recipe.description}</p>
                            
                            <div style="display: flex; gap: 20px; margin-bottom: 30px;">
                                <div class="glass" style="padding: 15px; flex: 1; text-align: center;">
                                    <i class="fas fa-user" style="color: var(--primary);"></i>
                                    <p style="font-size: 0.8rem; margin-top: 5px;">Published by</p>
                                    <strong>${recipe.author.username}</strong>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div style="margin-top: 50px; display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 40px;">
                        <div>
                            <h2 style="color: var(--primary); margin-bottom: 20px;"><i class="fas fa-carrot"></i> Ingredients</h2>
                            <ul style="list-style: none;">
                                ${recipe.ingredients.map(ing => `
                                    <li style="margin-bottom: 12px; display: flex; align-items: center; gap: 10px;">
                                        <i class="fas fa-check" style="color: var(--accent); font-size: 0.8rem;"></i>
                                        ${ing}
                                    </li>
                                `).join('')}
                            </ul>
                        </div>
                        <div>
                            <h2 style="color: var(--primary); margin-bottom: 20px;"><i class="fas fa-utensils"></i> Instructions</h2>
                            <div style="white-space: pre-line; line-height: 1.8;">${recipe.instructions}</div>
                        </div>
                    </div>

                    <div style="margin-top: 40px; padding-top: 30px; border-top: 1px solid var(--glass-border);">
                        <a href="index.html#recipes" class="btn btn-outline"><i class="fas fa-arrow-left"></i> Back to Recipes</a>
                    </div>
                `;
            } catch (error) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px;">
                        <i class="fas fa-exclamation-triangle" style="font-size: 3rem; color: var(--primary); margin-bottom: 20px;"></i>
                        <h2>Oops! Recipe Not Found</h2>
                        <p>The recipe you are looking for doesn't exist or has been removed.</p>
                        <a href="index.html" class="btn btn-primary" style="margin-top: 20px;">Return Home</a>
                    </div>
                `;
            }
        });
    </script>
</body>

</html>